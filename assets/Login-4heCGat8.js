import{u as y,r as c,c as C,o as x,a as I,b as u,d,e,w as g,v as h,t as _,f as v,g as N,h as V,i as D}from"./index-BTii5yc3.js";import{a as f}from"./axios-C8DqakIB.js";const M={id:"loginPage",class:"bg-yellow"},S={class:"conatiner loginPage vhContainer"},E=e("div",{class:"side"},[e("a",{href:"#"},[e("img",{class:"logoImg",src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/logo.png",alt:""})]),e("img",{class:"d-m-n",src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/img.png",alt:"workImg"})],-1),L={class:"formControls"},T=e("h2",{class:"formControls_txt"},"最實用的線上代辦事項服務",-1),U=e("label",{class:"formControls_label",for:"email"},"Email",-1),$={key:0},j=e("label",{class:"formControls_label",for:"pwd"},"密碼",-1),B={key:1},w="https://todolist-api.hexschool.io",J={__name:"Login",setup(R){const b=y(),a=c({email:"",password:""}),m=c(""),l=c(""),n=c([]),k=async()=>{try{const s=await f.post(`${w}/users/sign_in`,{email:a.value.email,password:a.value.password});p(s.data.token)}catch(s){const o=s.response.data.message;n.value=o}},p=async s=>{try{const o=await f.get(`${w}/users/checkout`,{headers:{Authorization:s}});m.value=o.data.nickname,l.value=s;const t=new Date;t.setDate(t.getDate()+1);const r={user:m.value,token:l.value};document.cookie=`authInfo=${JSON.stringify(r)}; expires=${t.toUTCString()}`,b.push("/todo")}catch(o){console.log(o)}},i=C(()=>{if(typeof n.value=="object"){const s=n.value.filter(t=>t.includes("email")),o=n.value.filter(t=>t.includes("password"));return{email:s.join(", "),password:o.join(", ")}}else return{email:n.value,password:n.value}});return x(()=>{var o;const s=(o=document.cookie.split("; ").find(t=>t.startsWith("authInfo=")))==null?void 0:o.split("=")[1];s&&(l.value=JSON.parse(s).token,p(l.value))}),(s,o)=>{const t=I("RouterLink");return u(),d("div",M,[e("div",S,[E,e("div",null,[e("form",L,[T,U,g(e("input",{"onUpdate:modelValue":o[0]||(o[0]=r=>a.value.email=r),class:"formControls_input",type:"text",id:"email",name:"email",placeholder:"請輸入 email",required:""},null,512),[[h,a.value.email]]),i.value.email?(u(),d("span",$,_(i.value.email),1)):v("",!0),j,g(e("input",{"onUpdate:modelValue":o[1]||(o[1]=r=>a.value.password=r),class:"formControls_input",type:"password",name:"pwd",id:"pwd",placeholder:"請輸入密碼",required:""},null,512),[[h,a.value.password]]),i.value.password?(u(),d("span",B,_(i.value.password),1)):v("",!0),e("button",{type:"button",class:"formControls_btnSubmit",onClick:k},"登入"),N(t,{to:"/register",class:"formControls_btnLink"},{default:V(()=>[D("註冊帳號")]),_:1})])])])])}}};export{J as default};
